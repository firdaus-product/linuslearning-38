<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matematik Ceria: Operasi Darab Asas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* --- UI STYLE (MASTER REFERENCE - TEMA HIJAU) --- */
    body { 
        font-family: 'Fredoka', sans-serif; 
        background-color: #f0fdf4; 
        background-image: radial-gradient(#86efac 2px, transparent 2px); 
        background-size: 30px 30px; 
    }
    
    .game-card { 
        background: white; 
        border: 4px solid #475569; 
        box-shadow: 8px 8px 0px #00000020; 
        border-radius: 1.5rem; 
        min-height: 600px; 
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        overflow: hidden;
    }
    
    /* Buttons */
    .btn-3d { 
        transition: all 0.1s; 
        border-bottom-width: 6px; 
        border-color: rgba(0,0,0,0.2); 
        transform: translateY(0); 
        cursor: pointer; 
        display: inline-block; 
    }
    .btn-3d:active:not(:disabled) { transform: translateY(4px); border-bottom-width: 2px; box-shadow: none; }
    .btn-3d:disabled { opacity: 0.6; cursor: not-allowed; border-bottom-width: 6px; filter: grayscale(100%); }

    /* Inputs (Range Slider) */
    input[type=range] {
        accent-color: #22c55e; /* Green-500 */
        cursor: pointer;
    }

    /* --- STYLE KHUSUS DARAB ASAS --- */

    /* Aktiviti 1: Mesin Kumpulan */
    .group-box {
        border: 3px solid #93c5fd; background: #eff6ff;
        border-radius: 1rem; padding: 10px; margin: 8px;
        min-width: 90px; min-height: 90px;
        box-shadow: 0 4px 0 #bfdbfe;
        display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
    }
    .group-item {
        width: 30px; height: 30px;
        border-radius: 50%; background: #2563eb;
        display: flex; align-items: center; justify-content: center;
        color: white; font-size: 1.2rem; margin: 2px;
        box-shadow: inset 0 -2px 0 rgba(0,0,0,0.2);
    }

    /* Aktiviti 2: Kotak Pusing */
    .visual-grid {
        display: grid; gap: 6px;
        border: 4px dashed #86efac; background: #f0fdf4;
        padding: 16px; border-radius: 1rem;
        transition: all 0.5s ease-in-out;
    }
    .grid-dot {
        width: 24px; height: 24px;
        background: #16a34a; border-radius: 50%;
        margin: 0 auto;
    }

    /* Aktiviti 3: Garis Nombor */
    .numline-container {
        background: #faf5ff; border: 3px solid #e9d5ff;
        border-radius: 1rem; padding: 1.5rem;
        width: 100%; overflow-x: auto; position: relative;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    .numline-track {
        display: flex; border-bottom: 4px solid #7e22ce;
        padding-bottom: 10px; min-width: max-content;
    }
    .numline-item {
        width: 40px; text-align: center; position: relative; flex-shrink: 0;
        color: #581c87; font-weight: 600;
    }
    .numline-item::after {
        content: ''; position: absolute; bottom: -14px; left: 50%; transform: translateX(-50%);
        width: 2px; height: 10px; background: #7e22ce;
    }
    .numline-item.active { color: #9333ea; transform: scale(1.2); font-weight: 800; }
    .frog-char {
        position: absolute; bottom: 35px; left: 0;
        font-size: 2.5rem; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        filter: drop-shadow(2px 4px 0 rgba(0,0,0,0.1));
    }

    /* Aktiviti 4 & 5: Sifir 0 & 1 */
    .glass-box {
        border: 4px solid #fdba74; background: #fff7ed;
        border-radius: 0 0 1rem 1rem; border-top: 0;
        width: 80px; height: 100px;
        display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
        font-size: 2.5rem; margin: 8px; position: relative;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    /* Rim gelas */
    .glass-box::before {
        content: ''; position: absolute; top: -5px; left: -4px; right: -4px;
        height: 10px; border: 4px solid #fdba74; border-radius: 50%;
        background: rgba(255,255,255,0.5);
    }
    .glass-box.sifir-satu {
        border-color: #fda4af; background: #fff1f2;
    }
    .glass-box.sifir-satu::before { border-color: #fda4af; }

  </style>
</head>
<body class="min-h-screen text-slate-800 pb-10">

  <div class="fixed top-4 left-0 right-0 z-50 px-4 pointer-events-none">
    <div class="max-w-4xl mx-auto bg-green-400 border-4 border-green-600 rounded-full px-6 py-3 shadow-xl flex items-center justify-between pointer-events-auto transform hover:scale-[1.01] transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-3xl animate-bounce">‚úñÔ∏è</span>
        <span id="info-text" class="text-xl font-bold text-green-900 leading-none mt-1">Operasi Darab Asas</span>
      </div>
      <button id="speak-btn" onclick="speakInfo()" class="bg-white hover:bg-green-50 text-green-600 border-2 border-green-200 rounded-full p-2 transition-colors shadow-sm">üîä</button>
    </div>
  </div>
  <div class="h-24"></div>

  <div class="max-w-6xl mx-auto p-4">
    
    <div class="game-card p-8 mb-8">
        <div id="activity-content" class="w-full relative z-10 flex flex-col items-center justify-center h-full">
            <div class="py-10 text-center">
                <div class="text-8xl mb-6 animate-pulse">üî¢</div>
                <h2 class="text-5xl font-bold text-emerald-600 mb-4">Konsep Darab</h2>
                <p class="text-2xl text-slate-500 mb-8 font-semibold">Kumpulan, Sifir dan Garis Nombor.</p>
                <div class="text-4xl animate-bounce">üëá</div>
            </div>
        </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-2 border-white">
      <h3 class="text-2xl font-bold text-slate-700 mb-4 text-center">üéÆ Pilih Aktiviti</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
        <button onclick="loadActivity(1)" class="btn-3d bg-blue-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üçé Mesin Kumpulan</button>
        <button onclick="loadActivity(2)" class="btn-3d bg-green-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üîÑ Kotak Pusing</button>
        <button onclick="loadActivity(3)" class="btn-3d bg-purple-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üê∏ Lompat Sifir</button>
        <button onclick="loadActivity(4)" class="btn-3d bg-orange-500 text-white font-bold py-4 px-2 rounded-xl text-lg">ü•õ Misteri Sifir 0</button>
        <button onclick="loadActivity(5)" class="btn-3d bg-rose-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üîµ Misteri Sifir 1</button>
      </div>

      <div class="flex justify-center gap-4 border-t-2 border-slate-100 pt-6">
        <button onclick="clearActivity()" class="btn-3d bg-slate-400 text-white font-bold py-2 px-6 rounded-full text-lg">üè† Menu</button>
        <button onclick="nextActivity()" class="btn-3d bg-indigo-500 text-white font-bold py-2 px-8 rounded-full text-xl">Seterusnya ‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <script>
    /* --- STANDARD HELPERS --- */
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Pilih aktiviti untuk mula belajar darab!";
    
    // State Global Aktiviti
    window.commState = { a: 2, b: 5, rotated: false };
    window.numlineState = { sifir: 2, steps: 0, max: 20 };

    function triggerWin() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }

    function speak(text) { 
        if (!ttsEnabled || !('speechSynthesis' in window)) return; 
        window.speechSynthesis.cancel(); 
        const u = new SpeechSynthesisUtterance(text); u.lang = 'ms-MY'; u.rate = 0.95; u.pitch = 1.05; 
        const ms = window.speechSynthesis.getVoices().find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms')); 
        if (ms) u.voice = ms; 
        window.speechSynthesis.speak(u); 
    }
    
    function setInfo(text) { 
        currentInfo = text; const infoEl = document.getElementById('info-text'); 
        infoEl.style.opacity = 0; setTimeout(() => { infoEl.textContent = text; infoEl.style.opacity = 1; }, 200); 
    }
    
    function speakInfo() { 
        if (!ttsEnabled) { ttsEnabled = true; document.getElementById('speak-btn').classList.add('bg-green-100', 'text-green-600'); } 
        speak(currentInfo); 
    }

    /* --- ROUTER --- */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      content.style.opacity = 0;
      setTimeout(() => {
          if (n === 1) loadGroupMachineActivity(content);
          if (n === 2) loadCommutativeBoxActivity(content);
          if (n === 3) loadNumberLineActivity(content);
          if (n === 4) loadSifirZeroActivity(content);
          if (n === 5) loadSifirOneActivity(content);
          content.style.opacity = 1;
      }, 200);
    }

    function clearActivity() {
        currentActivity = 0;
        document.getElementById('activity-content').innerHTML = `<div class="py-10 text-center"><div class="text-8xl mb-6 animate-pulse">üî¢</div><h2 class="text-5xl font-bold text-emerald-600 mb-4">Konsep Darab</h2><p class="text-2xl text-slate-500 mb-8 font-semibold">Pilih butang di bawah.</p></div>`;
        setInfo("Pilih aktiviti untuk mula belajar!");
    }
    function nextActivity() { let next = currentActivity + 1; if (next > 5) next = 1; loadActivity(next); }


    /* =========================================
       LOGIK AKTIVITI
       ========================================= */

    /* 1. Mesin Kumpulan */
    function loadGroupMachineActivity(content) {
      setInfo("Guna slider untuk ubah Kumpulan dan Ahli.");
      content.innerHTML = `
        <div class="w-full max-w-4xl">
            <h3 class="text-3xl font-bold text-blue-500 mb-6 text-center">üçé Mesin Kumpulan</h3>
            
            <div class="flex flex-col md:flex-row gap-8 items-start">
                <div class="w-full md:w-1/3 bg-blue-50 p-6 rounded-2xl border-2 border-blue-200">
                    <div class="mb-6">
                        <label class="block text-lg font-bold text-blue-800 mb-2">Bilangan Kumpulan: <span id="val-kumpulan" class="text-2xl text-blue-600">3</span></label>
                        <input type="range" id="slider-kumpulan" min="1" max="5" value="3" class="w-full h-4 bg-blue-200 rounded-lg appearance-none cursor-pointer" oninput="renderGroupMachine()">
                    </div>
                    <div>
                        <label class="block text-lg font-bold text-blue-800 mb-2">Ahli per Kumpulan: <span id="val-ahli" class="text-2xl text-blue-600">2</span></label>
                        <input type="range" id="slider-ahli" min="0" max="8" value="2" class="w-full h-4 bg-blue-200 rounded-lg appearance-none cursor-pointer" oninput="renderGroupMachine()">
                    </div>
                </div>
                
                <div class="w-full md:w-2/3">
                    <div id="group-visual" class="flex flex-wrap justify-center items-center bg-slate-50 border-2 border-slate-200 p-4 rounded-2xl min-h-[200px] mb-4"></div>
                    <div id="group-result" class="text-center text-3xl font-black text-slate-700 bg-yellow-100 border-2 border-yellow-200 p-4 rounded-xl shadow-sm animate-bounce">
                        3 √ó 2 = 6
                    </div>
                </div>
            </div>
        </div>
      `;
      renderGroupMachine();
    }

    function renderGroupMachine() {
      const k = parseInt(document.getElementById('slider-kumpulan').value);
      const a = parseInt(document.getElementById('slider-ahli').value);
      document.getElementById('val-kumpulan').textContent = k;
      document.getElementById('val-ahli').textContent = a;
      
      const visualEl = document.getElementById('group-visual');
      visualEl.innerHTML = '';
      let total = 0;
      
      for (let i = 0; i < k; i++) {
        let itemsHTML = '';
        for (let j = 0; j < a; j++) itemsHTML += `<div class="group-item">üçé</div>`;
        visualEl.innerHTML += `<div class="group-box">${itemsHTML}</div>`;
        total += a;
      }
      
      document.getElementById('group-result').textContent = `${k} √ó ${a} = ${total}`;
    }

    /* 2. Kotak Pusing */
    function loadCommutativeBoxActivity(content) {
      window.commState = { a: 2, b: 5, rotated: false };
      setInfo("Adakah 2 x 5 sama dengan 5 x 2? Tekan 'Pusingkan!'.");
      content.innerHTML = `
        <div class="w-full max-w-4xl">
            <h3 class="text-3xl font-bold text-green-600 mb-6 text-center">üîÑ Kotak Pusing (Sifir Kalis Tukar Tertib)</h3>
            
            <div class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3 bg-green-50 p-6 rounded-2xl border-2 border-green-200">
                    <div class="mb-6">
                        <label class="block text-lg font-bold text-green-800 mb-2">Baris (A): <span id="val-a" class="text-2xl">2</span></label>
                        <input type="range" id="slider-a" min="1" max="6" value="2" class="w-full h-4 bg-green-200 rounded-lg cursor-pointer" oninput="updateCommState('a', this.value)">
                    </div>
                    <div class="mb-6">
                        <label class="block text-lg font-bold text-green-800 mb-2">Lajur (B): <span id="val-b" class="text-2xl">5</span></label>
                        <input type="range" id="slider-b" min="1" max="6" value="5" class="w-full h-4 bg-green-200 rounded-lg cursor-pointer" oninput="updateCommState('b', this.value)">
                    </div>
                    <button onclick="toggleCommRotation()" class="btn-3d bg-green-500 text-white font-bold py-3 px-4 rounded-xl text-lg w-full">
                        Pusingkan! üîÑ
                    </button>
                </div>
                
                <div class="w-full md:w-2/3 flex flex-col items-center">
                    <div id="comm-visual-grid" class="visual-grid mb-4"></div>
                    <div id="comm-result" class="text-center text-3xl font-black text-slate-700 bg-yellow-100 border-2 border-yellow-200 p-4 rounded-xl shadow-sm w-full">
                        2 √ó 5 = 10
                    </div>
                </div>
            </div>
        </div>
      `;
      renderCommutativeBox();
    }

    function updateCommState(key, value) {
      window.commState[key] = parseInt(value);
      window.commState.rotated = false; 
      renderCommutativeBox();
    }
    function toggleCommRotation() {
      window.commState.rotated = !window.commState.rotated;
      renderCommutativeBox();
      const { a, b, rotated } = window.commState;
      const msg = rotated ? `Sekarang ${b} baris, ${a} lajur.` : `Asal ${a} baris, ${b} lajur.`;
      speak(msg);
    }
    function renderCommutativeBox() {
      const { a, b, rotated } = window.commState;
      document.getElementById('val-a').textContent = a;
      document.getElementById('val-b').textContent = b;
      
      const gridEl = document.getElementById('comm-visual-grid');
      gridEl.innerHTML = '';
      const rows = rotated ? b : a;
      const cols = rotated ? a : b;
      
      gridEl.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
      
      for (let i = 0; i < rows * cols; i++) {
        gridEl.innerHTML += `<div class="grid-dot"></div>`;
      }
      
      document.getElementById('comm-result').textContent = rotated ? `${b} √ó ${a} = ${a * b}` : `${a} √ó ${b} = ${a * b}`;
    }

    /* 3. Lompat Sifir */
    function loadNumberLineActivity(content) {
      window.numlineState = { sifir: 2, steps: 0, max: 20 };
      setInfo("Pilih Sifir dan tekan 'Lompat!'.");
      content.innerHTML = `
        <div class="w-full max-w-4xl text-center">
            <h3 class="text-3xl font-bold text-purple-600 mb-6">üê∏ Lompat Sifir</h3>
            
            <div class="flex justify-center gap-4 mb-8">
                <button onclick="setSifir(2, 20)" class="btn-3d bg-purple-100 text-purple-800 font-bold py-2 px-6 rounded-xl">Sifir 2</button>
                <button onclick="setSifir(5, 50)" class="btn-3d bg-purple-100 text-purple-800 font-bold py-2 px-6 rounded-xl">Sifir 5</button>
                <button onclick="setSifir(10, 100)" class="btn-3d bg-purple-100 text-purple-800 font-bold py-2 px-6 rounded-xl">Sifir 10</button>
            </div>
            
            <div class="numline-container mb-8">
                <div id="numline-track" class="numline-track"></div>
                <div id="frog-char" class="frog-char">üê∏</div>
            </div>

            <div class="flex justify-center gap-4">
                <button onclick="jumpNumberLine()" class="btn-3d bg-purple-500 text-white font-bold py-3 px-8 rounded-xl text-xl">Lompat! üöÄ</button>
                <button onclick="resetNumberLine()" class="btn-3d bg-slate-400 text-white font-bold py-3 px-6 rounded-xl text-xl">Reset ‚Ü∫</button>
            </div>
            
            <div id="numline-result" class="mt-6 text-2xl font-bold text-slate-600">Mula di 0</div>
        </div>
      `;
      renderNumberLine();
    }

    function setSifir(s, m) {
      window.numlineState = { sifir: s, steps: 0, max: m };
      renderNumberLine();
      setInfo(`Sifir ${s} dipilih.`);
    }
    function resetNumberLine() { setSifir(window.numlineState.sifir, window.numlineState.max); }
    
    function renderNumberLine() {
      const { max } = window.numlineState;
      const track = document.getElementById('numline-track');
      track.innerHTML = '';
      for(let i=0; i<=max; i++) {
        track.innerHTML += `<div class="numline-item" id="num-${i}">${i}</div>`;
      }
      document.getElementById('num-0').classList.add('active');
      document.getElementById('frog-char').style.transform = 'translateX(0px)';
      document.getElementById('numline-result').textContent = "Mula di 0";
    }
    
    function jumpNumberLine() {
      const { sifir, steps, max } = window.numlineState;
      const newSteps = steps + 1;
      const newPos = newSteps * sifir;
      
      if(newPos > max) { speak("Dah sampai hujung."); return; }
      
      window.numlineState.steps = newSteps;
      
      // Visual Updates
      document.querySelectorAll('.numline-item.active').forEach(el => el.classList.remove('active'));
      const targetEl = document.getElementById(`num-${newPos}`);
      targetEl.classList.add('active');
      
      // Calculate Frog Position (approximate logic since we use overflow-x)
      // For exact positioning in a scroll container, usually involves measuring offsetLeft.
      // Here we simplify by scrolling the container or just moving the frog relative to container.
      const trackContainer = document.querySelector('.numline-container');
      const frog = document.getElementById('frog-char');
      
      // Move frog visually
      const distance = targetEl.offsetLeft; 
      frog.style.transform = `translateX(${distance}px)`;
      
      // Auto Scroll if needed
      if (distance > trackContainer.clientWidth / 2) {
          trackContainer.scrollTo({ left: distance - trackContainer.clientWidth / 2, behavior: 'smooth' });
      }

      const txt = `${newSteps} √ó ${sifir} = ${newPos}`;
      document.getElementById('numline-result').textContent = `Lompatan ke-${newSteps}: ${txt}`;
      speak(txt);
      if(newPos === max) triggerWin();
    }

    /* 4. Sifir 0 */
    function loadSifirZeroActivity(content) {
      setInfo("Guna slider. Apa jadi bila darab 0?");
      content.innerHTML = `
        <div class="w-full max-w-3xl text-center">
            <h3 class="text-3xl font-bold text-orange-500 mb-6">ü•õ Misteri Sifir 0</h3>
            
            <div class="bg-orange-50 p-6 rounded-2xl border-2 border-orange-200 mb-6">
                <label class="block text-xl font-bold text-orange-800 mb-2">Bilangan Gelas (Kosong): <span id="val-gelas-0">1</span></label>
                <input type="range" id="slider-gelas-0" min="1" max="8" value="1" class="w-full h-4 bg-orange-200 rounded-lg cursor-pointer" oninput="renderSifirZero()">
            </div>

            <div id="visual-sifir-0" class="flex flex-wrap justify-center items-center min-h-[150px] mb-4"></div>
            
            <div id="result-sifir-0" class="text-3xl font-black text-orange-600 bg-white border-2 border-orange-100 p-4 rounded-xl shadow-sm">
                1 √ó 0 = 0
            </div>
        </div>
      `;
      renderSifirZero();
    }
    function renderSifirZero() {
      const n = document.getElementById('slider-gelas-0').value;
      document.getElementById('val-gelas-0').textContent = n;
      
      const box = document.getElementById('visual-sifir-0');
      box.innerHTML = '';
      for(let i=0; i<n; i++) box.innerHTML += `<div class="glass-box"></div>`; // Empty glasses
      
      document.getElementById('result-sifir-0').textContent = `${n} √ó 0 = 0`;
    }

    /* 5. Sifir 1 */
    function loadSifirOneActivity(content) {
      setInfo("Guna slider. Apa jadi bila darab 1?");
      content.innerHTML = `
        <div class="w-full max-w-3xl text-center">
            <h3 class="text-3xl font-bold text-rose-500 mb-6">üîµ Misteri Sifir 1</h3>
            
            <div class="bg-rose-50 p-6 rounded-2xl border-2 border-rose-200 mb-6">
                <label class="block text-xl font-bold text-rose-800 mb-2">Bilangan Gelas (1 Guli): <span id="val-gelas-1">4</span></label>
                <input type="range" id="slider-gelas-1" min="1" max="8" value="4" class="w-full h-4 bg-rose-200 rounded-lg cursor-pointer" oninput="renderSifirOne()">
            </div>

            <div id="visual-sifir-1" class="flex flex-wrap justify-center items-center min-h-[150px] mb-4"></div>
            
            <div id="result-sifir-1" class="text-3xl font-black text-rose-600 bg-white border-2 border-rose-100 p-4 rounded-xl shadow-sm">
                4 √ó 1 = 4
            </div>
        </div>
      `;
      renderSifirOne();
    }
    function renderSifirOne() {
      const n = document.getElementById('slider-gelas-1').value;
      document.getElementById('val-gelas-1').textContent = n;
      
      const box = document.getElementById('visual-sifir-1');
      box.innerHTML = '';
      for(let i=0; i<n; i++) box.innerHTML += `<div class="glass-box sifir-satu"><div class="text-3xl mb-2">üîµ</div></div>`;
      
      document.getElementById('result-sifir-1').textContent = `${n} √ó 1 = ${n}`;
    }

  </script>
</body>
</html>
